<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Email Sorter by MrKarik</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    textarea { width: 100%; height: 200px; }
    button { margin: 5px; padding: 10px 15px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    h2 { color: #2c3e50; }
    .mode { margin: 10px 0; }
  </style>
</head>
<body>
  <h2>ðŸ“§ Email Sorter by MrKarik</h2>
  <p>Paste your emails below (one per line) or upload a file:</p>
  
  <textarea id="emailInput" placeholder="example@gmail.com"></textarea><br>
  <input type="file" id="fileInput"><br>

  <div class="mode">
    <label><input type="radio" name="mode" value="raw" checked> Raw (100 providers)</label>
    <label><input type="radio" name="mode" value="grouped"> Grouped (Gmail, Yahoo, Office365, Owa, Roundcube, Others)</label>
  </div>

  <button onclick="sortEmails()">Sort Only</button>
  <button onclick="downloadAll()">Download All as ZIP</button>

  <div id="results"></div>

  <script>
    // Raw 100 providers list
    const providers = [
      "gmail.com","yahoo.com","outlook.com","hotmail.com","aol.com","icloud.com",
      "protonmail.com","zoho.com","gmx.com","yandex.com","mail.com","msn.com",
      "live.com","me.com","fastmail.com","tutanota.com","pm.me","comcast.net",
      "att.net","verizon.net","rocketmail.com","cox.net","charter.net",
      "optonline.net","earthlink.net","mac.com","bellsouth.net","shaw.ca",
      "rogers.com","btinternet.com","virginmedia.com","sky.com","talktalk.net",
      "office365.com","outlook.office365.com","owa.com","zimbra.com","hushmail.com",
      "inbox.com","lycos.com","rediffmail.com","web.de","163.com","126.com","qq.com",
      "sina.com","yeah.net","naver.com","daum.net","hanmail.net","seznam.cz",
      "centrum.cz","volny.cz","libero.it","tin.it","tiscali.it","alice.it","wanadoo.fr",
      "orange.fr","laposte.net","free.fr","neuf.fr","sfr.fr","hotmail.co.uk","outlook.co.uk",
      "yahoo.co.uk","yahoo.co.in","yahoo.co.jp","hotmail.fr","hotmail.de","outlook.de",
      "hotmail.it","outlook.it","terra.com","bol.com.br","uol.com.br","ig.com.br","r7.com",
      "globo.com","oi.com.br","bell.net","sympatico.ca","videotron.ca","hotmail.ca",
      "outlook.ca","yahoo.ca","bt.com","plus.com","blueyonder.co.uk","ntlworld.com",
      "virgin.net","eircom.net","telenet.be","skynet.be","planet.nl","hetnet.nl","zonnet.nl"
    ];

    // Grouped families
    const hostGroups = {
      gmail: [
        "gmail.com","googlemail.com","google.com","g-suite.com","workspace.google.com",
        "alphabet.com","abc.xyz"
      ],
      yahoo: [
        "yahoo.com","ymail.com","rocketmail.com","yahoo.co.uk","yahoo.co.in","yahoo.co.jp","yahoomail.com"
      ],
      office365: [
        "outlook.com","hotmail.com","live.com","msn.com","office365.com","owa.com","exchange.com",
        "outlook.office365.com","microsoft.com","hotmail.co.uk","outlook.co.uk","outlook.de","hotmail.de","outlook.it","hotmail.it"
      ],
      owa: ["owa.com","outlook.office365.com"],
      roundcube: ["roundcube.net","zimbra.com"] // Roundcube/Zimbra group
    };

    let sorted = {};

    document.getElementById("fileInput").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(ev) {
        document.getElementById("emailInput").value = ev.target.result;
      };
      reader.readAsText(file);
    });

    function sortEmails() {
      const mode = document.querySelector('input[name="mode"]:checked').value;
      const emails = document.getElementById("emailInput").value
        .split(/\r?\n/)
        .map(e => e.trim().toLowerCase())
        .filter(e => e.includes("@"));

      sorted = {};

      if (mode === "raw") {
        for (let p of providers) sorted[p] = [];
        sorted["others"] = [];
        emails.forEach(email => {
          const domain = email.split("@")[1];
          if (providers.includes(domain)) {
            sorted[domain].push(email);
          } else {
            sorted["others"].push(email);
          }
        });
      } else { // grouped
        sorted = { gmail: [], yahoo: [], office365: [], owa: [], roundcube: [], others: [] };
        emails.forEach(email => {
          const domain = email.split("@")[1];
          let placed = false;
          for (let group in hostGroups) {
            if (hostGroups[group].includes(domain)) {
              sorted[group].push(email);
              placed = true;
              break;
            }
          }
          if (!placed) sorted.others.push(email);
        });
      }

      renderResults();
    }

    function renderResults() {
      let html = "<table><tr><th>Provider/Group</th><th>Count</th><th>Download</th></tr>";
      for (let key in sorted) {
        if (sorted[key].length > 0) {
          html += `<tr>
            <td>${key}</td>
            <td>${sorted[key].length}</td>
            <td><button onclick="downloadProvider('${key}')">Download</button></td>
          </tr>`;
        }
      }
      html += "</table>";
      document.getElementById("results").innerHTML = html;
    }

    function downloadProvider(key) {
      const blob = new Blob([sorted[key].join("\n")], { type: "text/plain;charset=utf-8" });
      saveAs(blob, key + ".txt");
    }

    async function downloadAll() {
      const zip = new JSZip();
      for (let key in sorted) {
        if (sorted[key].length > 0) {
          zip.file(key + ".txt", sorted[key].join("\n"));
        }
      }
      const content = await zip.generateAsync({ type: "blob" });
      saveAs(content, "sorted_emails.zip");
    }
  </script>
</body>
</html>
