<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Email Sorter</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    textarea { width: 100%; height: 200px; }
    button { margin: 5px; padding: 10px 15px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  </style>
</head>
<body>
  <h2>ðŸ“§ Email Sorter</h2>
  <p>Paste your emails below (one per line) or upload a file:</p>
  
  <textarea id="emailInput" placeholder="example@gmail.com"></textarea><br>
  <input type="file" id="fileInput"><br>
  <button onclick="sortEmails()">Sort Only</button>
  <button onclick="downloadAll()">Download All as ZIP</button>

  <div id="results"></div>

  <script>
    // 30+ popular email providers
    const providers = [
      "gmail.com","yahoo.com","outlook.com","hotmail.com","aol.com","icloud.com",
      "protonmail.com","zoho.com","gmx.com","yandex.com","mail.com","msn.com",
      "live.com","me.com","fastmail.com","tutanota.com","pm.me","comcast.net",
      "att.net","verizon.net","rocketmail.com","cox.net","charter.net",
      "optonline.net","earthlink.net","mac.com","bellsouth.net","shaw.ca",
      "rogers.com","btinternet.com","virginmedia.com","sky.com","talktalk.net"
    ];

    let sorted = {};

    document.getElementById("fileInput").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(ev) {
        document.getElementById("emailInput").value = ev.target.result;
      };
      reader.readAsText(file);
    });

    function sortEmails() {
      const emails = document.getElementById("emailInput").value
        .split(/\r?\n/)
        .map(e => e.trim().toLowerCase())
        .filter(e => e.includes("@"));

      sorted = {};
      for (let provider of providers) {
        sorted[provider] = [];
      }
      sorted["others"] = [];

      emails.forEach(email => {
        const domain = email.split("@")[1];
        if (providers.includes(domain)) {
          sorted[domain].push(email);
        } else {
          sorted["others"].push(email);
        }
      });

      renderResults();
    }

    function renderResults() {
      let html = "<table><tr><th>Provider</th><th>Count</th><th>Download</th></tr>";
      for (let provider in sorted) {
        if (sorted[provider].length > 0) {
          html += `<tr>
            <td>${provider}</td>
            <td>${sorted[provider].length}</td>
            <td><button onclick="downloadProvider('${provider}')">Download</button></td>
          </tr>`;
        }
      }
      html += "</table>";
      document.getElementById("results").innerHTML = html;
    }

    function downloadProvider(provider) {
      const blob = new Blob([sorted[provider].join("\n")], { type: "text/plain;charset=utf-8" });
      saveAs(blob, provider + ".txt");
    }

    async function downloadAll() {
      const zip = new JSZip();
      for (let provider in sorted) {
        if (sorted[provider].length > 0) {
          zip.file(provider + ".txt", sorted[provider].join("\n"));
        }
      }
      const content = await zip.generateAsync({ type: "blob" });
      saveAs(content, "sorted_emails.zip");
    }
  </script>
</body>
</html>
